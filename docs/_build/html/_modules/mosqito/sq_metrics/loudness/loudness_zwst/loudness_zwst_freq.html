
<!DOCTYPE html>


<html lang="en" data-content_root="" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>mosqito.sq_metrics.loudness.loudness_zwst.loudness_zwst_freq &#8212; MOSQITO manual</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../../../../../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../../../../../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../../../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/source/_static/custom.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../../../../../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../../../../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js?v=af026a1d"></script>
    <script src="../../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/mosqito/sq_metrics/loudness/loudness_zwst/loudness_zwst_freq';</script>
    <link rel="icon" href="../../../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
    <meta name="docbuild:last-update" content="Mar 25, 2024"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../../../../../index.html">
  
  
  
  
  
    
    
    
    <img src="../../../../../_static/logo.png" class="logo__image only-light" alt=""/>
    <script>document.write(`<img src="../../../../../_static/logo.png" class="logo__image only-dark" alt=""/>`);</script>
  
  
    <p class="title logo__title">MOSQITO</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../../../source/user_guide/index.html">
                        User guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../../../source/reference/index.html">
                        API reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../../../source/contribution/index.html">
                        Contribution
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/Eomys/MoSQITo" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../../../source/user_guide/index.html">
                        User guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../../../source/reference/index.html">
                        API reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../../../source/contribution/index.html">
                        Contribution
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/Eomys/MoSQITo" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../../../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">mosqito.sq_m...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <h1>Source code for mosqito.sq_metrics.loudness.loudness_zwst.loudness_zwst_freq</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># Third party imports</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">linspace</span><span class="p">,</span> <span class="n">arange</span><span class="p">,</span> <span class="n">tile</span><span class="p">,</span> <span class="n">diff</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>

<span class="c1"># Local application imports</span>
<span class="kn">from</span> <span class="nn">mosqito.sound_level_meter.noct_spectrum.noct_synthesis</span> <span class="kn">import</span> <span class="n">noct_synthesis</span>
<span class="kn">from</span> <span class="nn">mosqito.sq_metrics.loudness.loudness_zwst._main_loudness</span> <span class="kn">import</span> <span class="n">_main_loudness</span>
<span class="kn">from</span> <span class="nn">mosqito.sq_metrics.loudness.loudness_zwst._calc_slopes</span> <span class="kn">import</span> <span class="n">_calc_slopes</span>
<span class="kn">from</span> <span class="nn">mosqito.utils</span> <span class="kn">import</span> <span class="n">amp2db</span>


<div class="viewcode-block" id="loudness_zwst_freq"><a class="viewcode-back" href="../../../../../source/reference/mosqito.sq_metrics.loudness.loudness_zwst.loudness_zwst_freq.html#mosqito.sq_metrics.loudness.loudness_zwst.loudness_zwst_freq.loudness_zwst_freq">[docs]</a><span class="k">def</span> <span class="nf">loudness_zwst_freq</span><span class="p">(</span><span class="n">spectrum</span><span class="p">,</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">field_type</span><span class="o">=</span><span class="s2">&quot;free&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the loudness value from a fine band spectrum</span>

<span class="sd">    This function computes the acoustic loudness according to Zwicker method for</span>
<span class="sd">    stationary signals (ISO.532-1:2017).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spectrum : array_like</span>
<span class="sd">        A RMS spectrum.</span>
<span class="sd">    freqs : array_like</span>
<span class="sd">        Frequency axis.</span>
<span class="sd">    field_type : {&#39;free&#39;, &#39;diffuse&#39;}</span>
<span class="sd">        Type of soundfield.</span>
<span class="sd">        Default is &#39;free&#39;</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    N : float or array_like</span>
<span class="sd">        Overall loudness array in [sones], size (Ntime,).</span>
<span class="sd">    N_specific : array_like</span>
<span class="sd">        Specific loudness array [sones/bark], size (Nbark, Ntime).</span>
<span class="sd">    bark_axis: array_like</span>
<span class="sd">        Bark axis array, size (Nbark,).</span>

<span class="sd">    Warning</span>
<span class="sd">    -------</span>
<span class="sd">    The sampling frequency of the signal must be &gt;= 48 kHz to fulfill requirements.</span>
<span class="sd">    If the provided signal doesn&#39;t meet the requirements, it will be resampled.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    .loudness_zwst : Loudness computation for a stationary time signal</span>
<span class="sd">    .loudness_zwst_perseg : Loudness computation by time-segment</span>
<span class="sd">    .loudness_zwtv : Loudness computation for a non-stationary time signal</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The total loudness :math:`N` is computed as the integral of the specific loudness :math:`N&#39;` measured in sone/bark, over the Bark scale.</span>
<span class="sd">    The values of specific loudness are evaluated from third octave band levels as function of critical band rate :math:`z` in Bark.</span>

<span class="sd">    .. math::</span>
<span class="sd">        N=\\int_{0}^{24Bark}N&#39;(z)\\textup{dz}</span>

<span class="sd">    Due to normative continuity, the method is in accordance with ISO 226:1987 equal loudness contours</span>
<span class="sd">    instead of ISO 226:2003, as defined in the following standards:</span>
<span class="sd">        * ISO 532:1975 (method B)</span>
<span class="sd">        * DIN 45631:1991</span>
<span class="sd">        * ISO 532-1:2017 (method 1)</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    :cite:empty:`L_zw-ZF91`</span>
<span class="sd">    :cite:empty:`L_zw-ISO.532-1:2017`</span>

<span class="sd">    .. bibliography::</span>
<span class="sd">        :keyprefix: L_zw-</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    .. plot::</span>
<span class="sd">       :include-source:</span>

<span class="sd">       &gt;&gt;&gt; from mosqito.sq_metrics import loudness_zwst_freq</span>
<span class="sd">       &gt;&gt;&gt; from mosqito.sound_level_meter import comp_spectrum</span>
<span class="sd">       &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">       &gt;&gt;&gt; import numpy as np</span>
<span class="sd">       &gt;&gt;&gt; fs=48000</span>
<span class="sd">       &gt;&gt;&gt; d=0.2</span>
<span class="sd">       &gt;&gt;&gt; dB=60</span>
<span class="sd">       &gt;&gt;&gt; time = np.arange(0, d, 1/fs)</span>
<span class="sd">       &gt;&gt;&gt; f = np.linspace(1000,5000, len(time))</span>
<span class="sd">       &gt;&gt;&gt; stimulus = 0.5 * (1 + np.sin(2 * np.pi * f * time))</span>
<span class="sd">       &gt;&gt;&gt; rms = np.sqrt(np.mean(np.power(stimulus, 2)))</span>
<span class="sd">       &gt;&gt;&gt; ampl = 0.00002 * np.power(10, dB / 20) / rms</span>
<span class="sd">       &gt;&gt;&gt; stimulus = stimulus * ampl</span>
<span class="sd">       &gt;&gt;&gt; spec, freqs = comp_spectrum(stimulus, fs, db=False)</span>
<span class="sd">       &gt;&gt;&gt; N, N_spec, bark_axis = loudness_zwst_freq(spec, freqs)</span>
<span class="sd">       &gt;&gt;&gt; plt.plot(bark_axis, N_spec)</span>
<span class="sd">       &gt;&gt;&gt; plt.xlabel(&quot;Frequency band [Bark]&quot;)</span>
<span class="sd">       &gt;&gt;&gt; plt.ylabel(&quot;Specific loudness [Sone/Bark]&quot;)</span>
<span class="sd">       &gt;&gt;&gt; plt.title(&quot;Loudness = &quot; + f&quot;{N:.2f}&quot; + &quot; [Sone]&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check the inputs</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spectrum</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Input spectrum and frequency axis must have the same shape&quot;</span><span class="p">)</span>

    <span class="c1"># 1D spectrum</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spectrum</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Input spectrum and frequency axis do not have the same length&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">freqs</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">24000</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">freqs</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">24</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;[WARNING] freqs argument is not wide enough to cover the full audio range. Missing frequency bands will be filled with 0. To fulfill the standard requirements, the frequency axis should go from 24Hz up to 24 kHz.&quot;</span>
            <span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">freqs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">freqs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">spectrum</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
                <span class="n">freqs</span><span class="p">,</span> <span class="n">spectrum</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span>
            <span class="p">)(</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24000</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">24000</span> <span class="o">//</span> <span class="n">df</span><span class="p">)))</span>
            <span class="n">freqs</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24000</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">24000</span> <span class="o">//</span> <span class="n">df</span><span class="p">))</span>
    <span class="c1"># 2D spectrum</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">nseg</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># one frequency axis per segment</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">freqs</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Input spectrum and frequency axis do not have the same shape.&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">freqs</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">24000</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">freqs</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">24</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;[WARNING] freqs argument is not wide enough to cover the full audio range. Missing frequency bands will be filled with 0. To fulfill the standard requirements, the frequency axis should go from 24Hz up to 24 kHz.&quot;</span>
                <span class="p">)</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">diff</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                <span class="n">nperseg</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">24000</span> <span class="o">//</span> <span class="n">df</span><span class="p">)</span>
                <span class="n">spectrum</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">interp1d</span><span class="p">(</span>
                        <span class="n">freqs</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span>
                        <span class="n">spectrum</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span>
                        <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="p">)(</span><span class="n">tile</span><span class="p">(</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24000</span><span class="p">,</span> <span class="n">nperseg</span><span class="p">),</span> <span class="n">nseg</span><span class="p">))</span>
                    <span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nseg</span><span class="p">,</span> <span class="n">nperseg</span><span class="p">))</span>
                    <span class="o">.</span><span class="n">T</span>
                <span class="p">)</span>
                <span class="n">freqs</span> <span class="o">=</span> <span class="n">tile</span><span class="p">(</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24000</span><span class="p">,</span> <span class="n">nperseg</span><span class="p">),</span> <span class="p">(</span><span class="n">nseg</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="c1"># one frequency axis for all the segments</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;Input spectra and frequency axis do not have the same length. &quot;freqs&quot; must have dim(nperseg) and &quot;spectra&quot; must have dim(nperseg,nseg).&#39;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">freqs</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">24000</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">freqs</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">24</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;[WARNING] freqs argument is not wide enough to cover the full audio range. Missing frequency bands will be filled with 0. To fulfill the standard requirements, the frequency axis should go from 24Hz up to 24 kHz.&quot;</span>
                <span class="p">)</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">freqs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">freqs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">nperseg</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">24000</span> <span class="o">//</span> <span class="n">df</span><span class="p">)</span>
                <span class="n">spectrum</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
                    <span class="n">freqs</span><span class="p">,</span> <span class="n">spectrum</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span>
                <span class="p">)(</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24000</span><span class="p">,</span> <span class="n">nperseg</span><span class="p">))</span>
                <span class="n">freqs</span> <span class="o">=</span> <span class="n">tile</span><span class="p">(</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24000</span><span class="p">,</span> <span class="n">nperseg</span><span class="p">),</span> <span class="p">(</span><span class="n">nseg</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>

    <span class="c1"># Compute third octave band spectrum</span>
    <span class="n">spec_third</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">noct_synthesis</span><span class="p">(</span><span class="n">spectrum</span><span class="p">,</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="mi">12600</span><span class="p">)</span>

    <span class="c1"># Compute dB values</span>
    <span class="n">spec_third</span> <span class="o">=</span> <span class="n">amp2db</span><span class="p">(</span><span class="n">spec_third</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="mf">2e-5</span><span class="p">)</span>

    <span class="c1"># Compute main loudness</span>
    <span class="n">Nm</span> <span class="o">=</span> <span class="n">_main_loudness</span><span class="p">(</span><span class="n">spec_third</span><span class="p">,</span> <span class="n">field_type</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="c1"># Computation of specific loudness pattern and integration of overall</span>
    <span class="c1"># loudness by attaching slopes towards higher frequencies</span>
    <span class="n">N</span><span class="p">,</span> <span class="n">N_specific</span> <span class="o">=</span> <span class="n">_calc_slopes</span><span class="p">(</span><span class="n">Nm</span><span class="p">)</span>

    <span class="c1"># Define Bark axis</span>
    <span class="n">bark_axis</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">24</span> <span class="o">/</span> <span class="mf">0.1</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">N</span><span class="p">,</span> <span class="n">N_specific</span><span class="p">,</span> <span class="n">bark_axis</span></div>
</pre></div>

                </article>
              
              
              
              
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../../../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../../../../../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      Â© Copyright 2024, Green Forge Coop.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.1.2.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.14.4.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>